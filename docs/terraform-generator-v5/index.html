<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>terraform-generator - v5</title>
	<meta name="description" content="Documentation for terraform-generator - v5">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">terraform-generator - v5</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>terraform-generator - v5</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#terraform-generator" id="terraform-generator" style="color: inherit; text-decoration: none;">
					<h1><strong>terraform-generator</strong></h1>
				</a>
				<p><a href="https://www.npmjs.com/package/terraform-generator"><img src="https://img.shields.io/npm/v/terraform-generator" alt="npm package"></a>
					<a href="https://www.npmjs.com/package/terraform-generator"><img src="https://img.shields.io/npm/dt/terraform-generator" alt="npm downloads"></a>
					<a href="https://github.com/ahzhezhe/terraform-generator"><img src="https://github.com/ahzhezhe/terraform-generator/workflows/test/badge.svg?branch=master" alt="GitHub test"></a>
					<a href="https://github.com/ahzhezhe/terraform-generator/issues"><img src="https://img.shields.io/github/issues/ahzhezhe/terraform-generator" alt="GitHub issues"></a>
				<a href="https://github.com/ahzhezhe/terraform-generator/blob/master/LICENSE"><img src="https://img.shields.io/github/license/ahzhezhe/terraform-generator" alt="GitHub license"></a></p>
				<p>Use Node.js to generate Terraform configurations.</p>
				<p>You do not need to have Terraform installed to use this module.</p>
				<p>The end result of using this module is Terraform configurations in plain text, you will need to write the text  into a file (terraform-generator does provide an utility function to write the file for you) and execute it yourself.</p>
				<p>Currently support generating configurations for Terraform version &gt;= 0.12.</p>
				<p><a href="https://ahzhezhe.github.io/docs/terraform-generator-v5/index.html">API Documentation</a></p>
				<a href="#benefit" id="benefit" style="color: inherit; text-decoration: none;">
					<h2><strong>Benefit</strong></h2>
				</a>
				<p>Make use of all Javascript programming features (some of which is not available in Terraform), e.g. functions, array, loops, if-else, map, etc. to generate a plain Terraform configurations.</p>
				<p>You can easily maintain your infra in Javascript/Typescript.</p>
				<p>You don&#39;t need to use Terraform variables, you can use your own Javascript/JSON variables or use dotenv.</p>
				<p>You don&#39;t need to use Terraform modules for reusable resource creations, you can make use of Javascript functions.</p>
				<p>You can incorporate other Node.js libraries to facilitate your work.</p>
				<a href="#limitation" id="limitation" style="color: inherit; text-decoration: none;">
					<h2><strong>Limitation</strong></h2>
				</a>
				<p>The generated configurations are unformatted and its validity is not verified, use <code>terraform fmt</code> and <code>terraform plan</code> to format it and check its validity yourself.</p>
				<a href="#install-via-npm" id="install-via-npm" style="color: inherit; text-decoration: none;">
					<h2><strong>Install via NPM</strong></h2>
				</a>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> </span><span style="color: #001080">terraform</span><span style="color: #000000">-</span><span style="color: #001080">generator</span>
</code></pre>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2><strong>Usage</strong></h2>
				</a>
				<a href="#import" id="import" style="color: inherit; text-decoration: none;">
					<h3><strong>Import</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">TerraformGenerator</span><span style="color: #000000">, </span><span style="color: #001080">Resource</span><span style="color: #000000">, </span><span style="color: #001080">map</span><span style="color: #000000">, </span><span style="color: #001080">fn</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;terraform-generator&#039;</span><span style="color: #000000">;</span>
</code></pre>
				<p>or</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">TerraformGenerator</span><span style="color: #000000">, </span><span style="color: #0070C1">Resource</span><span style="color: #000000">, </span><span style="color: #0070C1">map</span><span style="color: #000000">, </span><span style="color: #0070C1">fn</span><span style="color: #000000"> } = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;terraform-generator&#039;</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#initialize-terraformgenerator" id="initialize-terraformgenerator" style="color: inherit; text-decoration: none;">
					<h3><strong>Initialize TerraformGenerator</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">tfg</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">TerraformGenerator</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">required_version:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;&gt;= 0.12&#039;</span>
<span style="color: #000000">});</span>
</code></pre>
				<a href="#blocks" id="blocks" style="color: inherit; text-decoration: none;">
					<h3><strong>Blocks</strong></h3>
				</a>
				<p>Block&#39;s arguments are not typed, please refer to official Terraform documentation on what arguments can be supplied.</p>
				<pre><code class="language-javascript"><span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">provider</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;aws&#039;</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">region:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;ap-southeast-1&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">profile:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;example&#039;</span>
<span style="color: #000000">});</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">vpc</span><span style="color: #000000"> = </span><span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">resource</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;aws_vpc&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;vpc&#039;</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">cidr_block:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;172.88.0.0/16&#039;</span>
<span style="color: #000000">});</span>
</code></pre>
				<a href="#convert-resource-to-data-source" id="convert-resource-to-data-source" style="color: inherit; text-decoration: none;">
					<h3><strong>Convert resource to data source</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">vpc</span><span style="color: #000000"> </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #001080">vpcDS</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;other-terraform-generator-configuration&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">vpc</span><span style="color: #000000"> = </span><span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">dataFromResource</span><span style="color: #000000">(</span><span style="color: #001080">vpcDS</span><span style="color: #000000">, </span><span style="color: #0000FF">null</span><span style="color: #000000">, [</span><span style="color: #A31515">&#039;cidr_block&#039;</span><span style="color: #000000">, [</span><span style="color: #A31515">&#039;tags&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;tag&#039;</span><span style="color: #000000">]]);</span>
</code></pre>
				<a href="#arguments" id="arguments" style="color: inherit; text-decoration: none;">
					<h3><strong>Arguments</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #000000">{</span>
<span style="color: #000000">  string: </span><span style="color: #A31515">&#039;str&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  number: </span><span style="color: #098658">123</span><span style="color: #000000">,</span>
<span style="color: #000000">  boolean: </span><span style="color: #0000FF">true</span><span style="color: #000000">,</span>
<span style="color: #000000">  stringList: [</span><span style="color: #A31515">&#039;str1&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;str2&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;str3&#039;</span><span style="color: #000000">],</span>
<span style="color: #000000">  numberList: [</span><span style="color: #098658">111</span><span style="color: #000000">, </span><span style="color: #098658">222</span><span style="color: #000000">, </span><span style="color: #098658">333</span><span style="color: #000000">],</span>
<span style="color: #000000">  booleanList: [</span><span style="color: #0000FF">true</span><span style="color: #000000">, </span><span style="color: #0000FF">false</span><span style="color: #000000">, </span><span style="color: #0000FF">true</span><span style="color: #000000">],</span>
<span style="color: #000000">  tuple: [</span><span style="color: #A31515">&#039;str&#039;</span><span style="color: #000000">, </span><span style="color: #098658">123</span><span style="color: #000000">, </span><span style="color: #0000FF">true</span><span style="color: #000000">],</span>
<span style="color: #000000">  object: {</span>
<span style="color: #000000">    arg1: </span><span style="color: #A31515">&#039;str&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    arg2: </span><span style="color: #098658">123</span><span style="color: #000000">,</span>
<span style="color: #000000">    arg3: </span><span style="color: #0000FF">true</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">  objectList: [</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">arg1:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;str&#039;</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">arg1:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;str&#039;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  ],</span>
<span style="color: #000000">  objectListForVariable: </span><span style="color: #795E26">list</span><span style="color: #000000">(</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">arg1:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;str&#039;</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">arg1:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;str&#039;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  ),</span>
<span style="color: #000000">  map: </span><span style="color: #795E26">map</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">arg1:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;str&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">arg2:</span><span style="color: #000000"> </span><span style="color: #098658">123</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">arg3:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span>
<span style="color: #000000">  }),</span>
<span style="color: #000000">  block: </span><span style="color: #001080">block</span><span style="color: #000000">,</span>
<span style="color: #000000">  blockAttribute: </span><span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;attrName&#039;</span><span style="color: #000000">),</span>
<span style="color: #000000">  heredoc: </span><span style="color: #795E26">heredoc</span><span style="color: #000000">(</span><span style="color: #A31515">`line1</span>
<span style="color: #A31515">                        line2</span>
<span style="color: #A31515">                        line3`</span><span style="color: #000000">),</span>
<span style="color: #000000">  heredocJson: </span><span style="color: #795E26">heredoc</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">arg1:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;str&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">arg2:</span><span style="color: #000000"> </span><span style="color: #098658">123</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">arg3:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span>
<span style="color: #000000">  }),</span>
<span style="color: #000000">  function1: </span><span style="color: #795E26">fn</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;max&#039;</span><span style="color: #000000">, </span><span style="color: #098658">5</span><span style="color: #000000">, </span><span style="color: #098658">12</span><span style="color: #000000">, </span><span style="color: #098658">19</span><span style="color: #000000">),</span>
<span style="color: #000000">  function2: </span><span style="color: #795E26">fn</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;sort&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;a&#039;</span><span style="color: #000000">, </span><span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;attrName&#039;</span><span style="color: #000000">), </span><span style="color: #A31515">&#039;c&#039;</span><span style="color: #000000">),</span>
<span style="color: #000000">  functionElement: </span><span style="color: #795E26">fn</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;tolist&#039;</span><span style="color: #000000">, [</span><span style="color: #A31515">&#039;a&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;b&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;c&#039;</span><span style="color: #000000">]).</span><span style="color: #795E26">element</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">),</span>
<span style="color: #000000">  custom: </span><span style="color: #795E26">arg</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;max(5, 12, 9)&#039;</span><span style="color: #000000">),</span>
<span style="color: #000000">  interpolation: </span><span style="color: #A31515">`str-</span><span style="color: #0000FF">${</span><span style="color: #001080">block</span><span style="color: #000000FF">.</span><span style="color: #795E26">attr</span><span style="color: #000000FF">(</span><span style="color: #A31515">&#039;attrName&#039;</span><span style="color: #000000FF">)</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#attributes" id="attributes" style="color: inherit; text-decoration: none;">
					<h3><strong>Attributes</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;id&#039;</span><span style="color: #000000">)                                      </span><span style="color: #008000">// block id, string</span>
<span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">                                              </span><span style="color: #008000">// convenience getter function, same as attr(&#039;id&#039;)</span>
<span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnets&#039;</span><span style="color: #000000">)                                 </span><span style="color: #008000">// subnet objects, object list</span>
<span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnets.*.id&#039;</span><span style="color: #000000">)                            </span><span style="color: #008000">// subnet ids, string list</span>
<span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnets&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;*&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;id&#039;</span><span style="color: #000000">)            </span><span style="color: #008000">// same as above</span>
<span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnets.*.id[0]&#039;</span><span style="color: #000000">)                         </span><span style="color: #008000">// first subnet id, string</span>
<span style="color: #001080">block</span><span style="color: #000000">.</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnets&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;*&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">attr</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;id&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">element</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #008000">// same as above</span>
</code></pre>
				<a href="#variables" id="variables" style="color: inherit; text-decoration: none;">
					<h3><strong>Variables</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// You can directly add multiple variable values.</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">addVars</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">var1:</span><span style="color: #000000"> </span><span style="color: #098658">123</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">var2:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;abc&#039;</span>
<span style="color: #000000">});</span>

<span style="color: #008000">// You can also add single variable value while adding variable block to your configuration.</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">variable</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;password&#039;</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;string&#039;</span>
<span style="color: #000000">}, </span><span style="color: #A31515">&#039;p@ssW0rd&#039;</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#merge-multiple-configurations" id="merge-multiple-configurations" style="color: inherit; text-decoration: none;">
					<h3><strong>Merge multiple configurations</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// You can split your configuration into multiple files and merge them before you generate the final outcome.</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">merge</span><span style="color: #000000">(</span><span style="color: #001080">tfg2</span><span style="color: #000000">, </span><span style="color: #001080">tfg3</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#generate-terraform-configuration" id="generate-terraform-configuration" style="color: inherit; text-decoration: none;">
					<h3><strong>Generate Terraform configuration</strong></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// Generate Terraform configuration as string</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">generate</span><span style="color: #000000">();</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">tf</span><span style="color: #000000">);</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">tfvars</span><span style="color: #000000">);</span>

<span style="color: #008000">// Write Terraform configuration to a file</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">write</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">dir:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;outputDir&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">format:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span>
<span style="color: #000000">});</span>
</code></pre>
				<a href="#example" id="example" style="color: inherit; text-decoration: none;">
					<h2><strong>Example</strong></h2>
				</a>
				<pre><code class="language-javascript"><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">TerraformGenerator</span><span style="color: #000000">, { </span><span style="color: #001080">Map</span><span style="color: #000000">, </span><span style="color: #001080">map</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;terraform-generator&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">path</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;path&#039;</span><span style="color: #000000">;</span>

<span style="color: #008000">// Constants</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">project</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;example&#039;</span><span style="color: #000000">;</span>

<span style="color: #008000">// Environment variables</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">configs</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">env:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;dev&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">tiers:</span><span style="color: #000000"> [</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">name:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;web&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">cidr:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;172.88.100.0/22&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">subnetCidrs:</span><span style="color: #000000"> [</span><span style="color: #A31515">&#039;172.88.100.0/24&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;172.88.101.0/24&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;172.88.102.0/24&#039;</span><span style="color: #000000">]</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">name:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;app&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">cidr:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;172.88.104.0/22&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">subnetCidrs:</span><span style="color: #000000"> [</span><span style="color: #A31515">&#039;172.88.104.0/24&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;172.88.105.0/24&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;172.88.106.0/24&#039;</span><span style="color: #000000">]</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">name:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;db&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">cidr:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;172.88.108.0/22&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">subnetCidrs:</span><span style="color: #000000"> [</span><span style="color: #A31515">&#039;172.88.108.0/24&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;172.88.109.0/24&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;172.88.110.0/24&#039;</span><span style="color: #000000">]</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  ]</span>
<span style="color: #000000">};</span>

<span style="color: #008000">// Utility functions</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">getAvailabilityZone</span><span style="color: #000000"> = (</span><span style="color: #001080">i</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">): </span><span style="color: #267F99">string</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">i</span><span style="color: #000000"> === </span><span style="color: #098658">0</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;ap-southeast-1a&#039;</span><span style="color: #000000">;</span>
<span style="color: #000000">  } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">i</span><span style="color: #000000"> === </span><span style="color: #098658">1</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;ap-southeast-1b&#039;</span><span style="color: #000000">;</span>
<span style="color: #000000">  } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;ap-southeast-1c&#039;</span><span style="color: #000000">;</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">};</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">getTagName</span><span style="color: #000000"> = (</span><span style="color: #001080">type</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #001080">name</span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">string</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000">  </span><span style="color: #A31515">`</span><span style="color: #0000FF">${</span><span style="color: #001080">type</span><span style="color: #0000FF">}</span><span style="color: #A31515">-</span><span style="color: #0000FF">${</span><span style="color: #001080">project</span><span style="color: #0000FF">}</span><span style="color: #A31515">-</span><span style="color: #0000FF">${</span><span style="color: #001080">configs</span><span style="color: #000000FF">.</span><span style="color: #001080">env</span><span style="color: #0000FF">}${</span><span style="color: #001080">name</span><span style="color: #000000FF"> </span><span style="color: #000000">?</span><span style="color: #000000FF"> </span><span style="color: #A31515">`-</span><span style="color: #0000FF">${</span><span style="color: #001080">name</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000FF"> </span><span style="color: #000000">:</span><span style="color: #000000FF"> </span><span style="color: #A31515">&#039;&#039;</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">getTags</span><span style="color: #000000"> = (</span><span style="color: #001080">type</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #001080">name</span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">Map</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Map</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">Name:</span><span style="color: #000000"> </span><span style="color: #795E26">getTagName</span><span style="color: #000000">(</span><span style="color: #001080">type</span><span style="color: #000000">, </span><span style="color: #001080">name</span><span style="color: #000000">),</span>
<span style="color: #000000">  </span><span style="color: #001080">Project:</span><span style="color: #000000"> </span><span style="color: #001080">project</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">Env:</span><span style="color: #000000"> </span><span style="color: #001080">configs</span><span style="color: #000000">.</span><span style="color: #001080">env</span>
<span style="color: #000000">});</span>

<span style="color: #008000">// Start writing Terraform configuration</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">tfg</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">TerraformGenerator</span><span style="color: #000000">();</span>

<span style="color: #008000">// Configure provider</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">provider</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;aws&#039;</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">region:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;ap-southeast-1&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">profile:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;example&#039;</span>
<span style="color: #000000">});</span>

<span style="color: #008000">// Find VPC by name</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">vpc</span><span style="color: #000000"> = </span><span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">data</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;aws_vpc&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;vpc&#039;</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">filter:</span><span style="color: #000000"> [{</span>
<span style="color: #000000">    </span><span style="color: #001080">name:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;tag:Name&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">values:</span><span style="color: #000000"> [</span><span style="color: #795E26">getTagName</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;vpc&#039;</span><span style="color: #000000">)]</span>
<span style="color: #000000">  }]</span>
<span style="color: #000000">});</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">subnets</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">web:</span><span style="color: #000000"> [],</span>
<span style="color: #000000">  </span><span style="color: #001080">app:</span><span style="color: #000000"> [],</span>
<span style="color: #000000">  </span><span style="color: #001080">db:</span><span style="color: #000000"> []</span>
<span style="color: #000000">};</span>

<span style="color: #008000">// Create 3-tiers, each tier has 3 subnets spread across availabilty zones</span>
<span style="color: #001080">configs</span><span style="color: #000000">.</span><span style="color: #001080">tiers</span><span style="color: #000000">.</span><span style="color: #795E26">forEach</span><span style="color: #000000">(</span><span style="color: #001080">tier</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">tier</span><span style="color: #000000">.</span><span style="color: #001080">subnetCidrs</span><span style="color: #000000">.</span><span style="color: #795E26">forEach</span><span style="color: #000000">((</span><span style="color: #001080">cidr</span><span style="color: #000000">, </span><span style="color: #001080">i</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">name</span><span style="color: #000000"> = </span><span style="color: #A31515">`</span><span style="color: #0000FF">${</span><span style="color: #001080">tier</span><span style="color: #000000FF">.</span><span style="color: #001080">name</span><span style="color: #0000FF">}${</span><span style="color: #001080">i</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">subnet</span><span style="color: #000000"> = </span><span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">resource</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;aws_subnet&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">`subnet_</span><span style="color: #0000FF">${</span><span style="color: #001080">name</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">, {</span>
<span style="color: #000000">      </span><span style="color: #001080">vpc_id:</span><span style="color: #000000"> </span><span style="color: #001080">vpc</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">cidr_block:</span><span style="color: #000000"> </span><span style="color: #001080">cidr</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">availability_zone:</span><span style="color: #000000"> </span><span style="color: #795E26">getAvailabilityZone</span><span style="color: #000000">(</span><span style="color: #001080">i</span><span style="color: #000000">),</span>
<span style="color: #000000">      </span><span style="color: #001080">tags:</span><span style="color: #000000"> </span><span style="color: #795E26">getTags</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnet&#039;</span><span style="color: #000000">, </span><span style="color: #001080">name</span><span style="color: #000000">)</span>
<span style="color: #000000">    });</span>
<span style="color: #000000">    </span><span style="color: #001080">subnets</span><span style="color: #000000">[</span><span style="color: #001080">tier</span><span style="color: #000000">.</span><span style="color: #001080">name</span><span style="color: #000000">].</span><span style="color: #795E26">push</span><span style="color: #000000">(</span><span style="color: #001080">subnet</span><span style="color: #000000">);</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">});</span>

<span style="color: #008000">// Output all subnet ids</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">output</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;subnets&#039;</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">value:</span><span style="color: #000000"> </span><span style="color: #795E26">map</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">webSubnets:</span><span style="color: #000000"> </span><span style="color: #001080">subnets</span><span style="color: #000000">.</span><span style="color: #001080">web</span><span style="color: #000000">.</span><span style="color: #795E26">map</span><span style="color: #000000">(</span><span style="color: #001080">subnet</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080">subnet</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">),</span>
<span style="color: #000000">    </span><span style="color: #001080">appSubnets:</span><span style="color: #000000"> </span><span style="color: #001080">subnets</span><span style="color: #000000">.</span><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">map</span><span style="color: #000000">(</span><span style="color: #001080">subnet</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080">subnet</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">),</span>
<span style="color: #000000">    </span><span style="color: #001080">dbSubnets:</span><span style="color: #000000"> </span><span style="color: #001080">subnets</span><span style="color: #000000">.</span><span style="color: #001080">db</span><span style="color: #000000">.</span><span style="color: #795E26">map</span><span style="color: #000000">(</span><span style="color: #001080">subnet</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080">subnet</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">)</span>
<span style="color: #000000">  })</span>
<span style="color: #000000">});</span>

<span style="color: #008000">// Write the configuration into a terraform.tf file</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">outputDir</span><span style="color: #000000"> = </span><span style="color: #001080">path</span><span style="color: #000000">.</span><span style="color: #795E26">join</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;output&#039;</span><span style="color: #000000">, </span><span style="color: #001080">configs</span><span style="color: #000000">.</span><span style="color: #001080">env</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;subnets&#039;</span><span style="color: #000000">);</span>
<span style="color: #001080">tfg</span><span style="color: #000000">.</span><span style="color: #795E26">write</span><span style="color: #000000">({ </span><span style="color: #001080">dir:</span><span style="color: #000000"> </span><span style="color: #001080">outputDir</span><span style="color: #000000">, </span><span style="color: #001080">format:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000"> });</span>
</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class">
						<a href="classes/argument.html" class="tsd-kind-icon">Argument</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/attribute.html" class="tsd-kind-icon">Attribute</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/backend.html" class="tsd-kind-icon">Backend</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/block.html" class="tsd-kind-icon">Block</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/data.html" class="tsd-kind-icon">Data</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/function.html" class="tsd-kind-icon">Function</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/heredoc.html" class="tsd-kind-icon">Heredoc</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/list.html" class="tsd-kind-icon">List</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/locals.html" class="tsd-kind-icon">Locals</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/map.html" class="tsd-kind-icon">Map</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/module.html" class="tsd-kind-icon">Module</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/output.html" class="tsd-kind-icon">Output</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/provider.html" class="tsd-kind-icon">Provider</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/provisioner.html" class="tsd-kind-icon">Provisioner</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/resource.html" class="tsd-kind-icon">Resource</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/terraformgenerator.html" class="tsd-kind-icon">Terraform<wbr>Generator</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/variable.html" class="tsd-kind-icon">Variable</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/resourcetodataoptions.html" class="tsd-kind-icon">Resource<wbr>ToData<wbr>Options</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/writeoptions.html" class="tsd-kind-icon">Write<wbr>Options</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#arg" class="tsd-kind-icon">arg</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#attr" class="tsd-kind-icon">attr</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#fn" class="tsd-kind-icon">fn</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#heredoc" class="tsd-kind-icon">heredoc</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#list" class="tsd-kind-icon">list</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#map" class="tsd-kind-icon">map</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer>
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>